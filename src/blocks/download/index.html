<div class="download relative">
  <h2 class="download__title">Download</h2>

  <div class="download__first">
    <div class="download__step">
      <h3 class="download__step__title"><b>FrameNinja</b> v0.4.0</h3>
      <div class="well">
        <div class="well__title">Loading...</div>
        <p class="well__text"><a href="#!" id="downloadNinjaLink">Click here</a> if the download <br />hasn't started</p>
      </div>
      <div class="download__step__requirements">Windows 7 and higher</div>
    </div>
  </div>

  <div class="download__separator">
    <div class="download__separator__arrow">
      <include src="./img/download_arrow.svg"></include>
    </div>
    <div class="download__separator__line"></div>
  </div>

  <div class="download__second">
    <div class="download__step">
      <h3 class="download__step__title"><b>OBS Websocket Plugin</b></h3>
      <div class="download__step__controls">
        <a href="#!" id="downloadSocketLink" class="button button--blue">
          <include src="img/icons/download.svg"></include>
          <span><b>Download</b> OBS Websocket</span>
        </a>
      </div>
      <div class="download__step__requirements">*To <b>FrameNinja</b> could connect to <br />your <b>OBS Studio</b>, you need to install <br />this plugin.</div>
    </div>

    <div class="download__second__arrow">
      <include src="./img/download_arrow2.svg"></include>
    </div>

    <div class="download__step download__step--left">
      <h3 class="download__step__title"><b>How to activate?</b></h3>
      <ul class="download__step__list">
        <li>Run your OBS Studio (18 or higher)</li>
        <li>Choose Tools > OBS Websocket Setitings</li>
        <li>Turn on the checkbox “Enable Websocket server”</li>
      </ul>
      <img src="/img/download_obs.png" class="download__step__image">
    </div>
  </div>
</div>

<script>
(() => {
  const frameNinjaRepo = "https://api.github.com/repos/MiracleCreators/frameninja-releases/releases/latest"
  const websocketRepo = "https://api.github.com/repos/Palakis/obs-websocket/releases/latest"

  const frameninjaLink = document.querySelector("#downloadNinjaLink")
  const websocketLink = document.querySelector("#downloadSocketLink")

  fetch(frameNinjaRepo)
    .then(res => res.json())
    .then(json => {
      const href =
        "https://github.com/MiracleCreators/frameninja-releases/releases/download/v" +
        json.name +
        "/frameninja-setup-" +
        json.name +
        ".exe"

      frameninjaLink.setAttribute("href", href)

      const link = document.createElement('a');
      link.href = href;
      link.style.display = 'none'
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    })

  fetch(websocketRepo)    
    .then(res => res.json())
    .then(json => {
      const href =
        "https://github.com/Palakis/obs-websocket/releases/download/" +
        json.tag_name +
        "/obs-websocket-" +
        json.tag_name +
        "-Windows-Installer.exe"

      websocketLink.setAttribute("href", href)
    })
})()
</script>